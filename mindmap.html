<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mind Map Viewer</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #mindmap .collapsible-content {
      display: none;
    }
    #mindmap h1.is-open ~ .collapsible-content,
    #mindmap h2.is-open ~ .collapsible-content,
    #mindmap h3.is-open ~ .collapsible-content {
      display: block;
    }
  </style>
</head>
<body>
  <a href="index.html">&larr; Back to Index</a>
  <div id="mindmap"></div>
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
  <script>
    const file = new URLSearchParams(window.location.search).get('file');
    if (!file) {
      document.getElementById('mindmap').innerHTML = '<p>No file specified.</p>';
    } else {
      fetch(file)
        .then(response => {
          if (!response.ok) throw new Error('Markdown file not found');
          return response.text();
        })
        .then(text => {
          const converter = new showdown.Converter();
          let html = converter.makeHtml(text);
          // Wrap all content after each heading in a collapsible-content div
          html = html.replace(/<h([1-3])>(.*?)<\/h\1>(.*?)(?=<h[1-3]>|$)/gs, function(match, level, title, content) {
            content = content.trim();
            if (!content) return match;
            return `<h${level}>${title}</h${level}><div class="collapsible-content">${content}</div>`;
          });
          document.getElementById('mindmap').innerHTML = html;
          // Make headings collapsible
          document.querySelectorAll('#mindmap h1, #mindmap h2, #mindmap h3').forEach(heading => {
            heading.addEventListener('click', function() {
              heading.classList.toggle('is-open');
            });
          });
        })
        .catch(error => {
          document.getElementById('mindmap').innerHTML = `<p>Error loading markdown: ${error.message}</p>`;
        });
    }
  </script>
</body>
</html>
